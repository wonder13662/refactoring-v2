### 7.7 위임 숨기기(Hide Delegate)
반대 리팩터링: [7.8 중개자 제거하기(Remove Middle Man)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter07/7-8.md)
``` diff
-manager = aPerson.department.manager;
+manager = aPerson.manager;
+class Person {
+ get manager() { return this.department.maanger; }
+}
```
#### 배경
모듈화 설계를 제대로 하는 핵심은 캡슐화다. 어쩌면 가장 중요한 요소일 수도 있다. 캡슐화는 모듈들이 시스템의 다른 부분에 대해 알아야 할 내용을 줄여준다. 캡슐화가 잘 되어 있다면 무언가를 변경해야 할 때 함께 고려해야 할 모듈 수가 적어져서 코드를 변경하기가 훨씬 쉬워진다. 

객체 지향을 처음 배울 때는 캡슐화란 필드를 숨기는 것이라고 배운다. 그러다 경험이 쌓이면서 캡슐화의 역할이 그보다 많다는 사실을 깨닫는다.

예컨대  서버 객체의 필드가 가리키는 객체(위임 객체 - delegate)의 메서드를 호출하려면 클라이언트는 위임 객체를 알아야 한다. 위임 객체의 인터페이스가 바뀌면 이 인터페이스를 사용하는 모든 클라이언트가 코드를 수정해야 한다. 이러한 의존성을 없애려면 서버 자체에 위임 메서드를 만들어서 위임 객체의 존재를 숨겨버리면 된다. 그러면 위임 객체가 수정되더라도 서버 코드만 고치면 되며, 클라이언트는 아무런 영향을 받지 않는다.
#### 절차
##### (1) 위임 객체의 각 메서드에 해당하는 위임 메서드를 서버에 생성한다.
##### (2) 클라이언트가 위임 객체 대신 서버를 호출하도록 수정한다. 하나씩 바꿀 때마다 테스트한다.
##### (3) 모두 수정했다면, 서버로부터 위임 객체를 얻는 접근자를 제거한다.
##### (4) 테스트한다.
#### 예시
##### STEP 0
사람(Person)과 사람이 속한 부서(Department)를 다음처럼 정의했다. 클라이언트에서 어떤 사람이 속한 부서의 관리자를 알고 싶다고 하자. 그러기 위해서는 부서 객체부터 얻어와야 한다. 보다시피 클라이언트는 부서 클래스의 작동 방식, 다시 말해 부서 클래스가 관리자 정보를 제공한다는 사실을 알아야 한다.
``` javascript
// Person 클래스
class Person {
  constructor(name) {
    this._name = name;
  }
  get name() { return this._name; }
  get department() { return this._department; }
  set department(arg) { this._department = arg; }
}
// Department 클래스
class Department {
  get chargeCode() { return this._chargeCode; }
  set chargeCode(arg) { this._chargeCode = arg; }
  get manager() { return this._manager; }
  set manager(arg) { this._manager = arg; }
}
// 클라이언트
const manager = aPerson.department.manager;
```
##### STEP 1
[(1)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter07/7-7.md#1-%EC%9C%84%EC%9E%84-%EA%B0%9D%EC%B2%B4%EC%9D%98-%EA%B0%81-%EB%A9%94%EC%84%9C%EB%93%9C%EC%97%90-%ED%95%B4%EB%8B%B9%ED%95%98%EB%8A%94-%EC%9C%84%EC%9E%84-%EB%A9%94%EC%84%9C%EB%93%9C%EB%A5%BC-%EC%84%9C%EB%B2%84%EC%97%90-%EC%83%9D%EC%84%B1%ED%95%9C%EB%8B%A4) 이러한 의존성을 줄이려면 클라이언트가 부서 클래스를 볼 수 없게 숨기고, 대신 사람 클래스에 간단한 위임 메서드를 만들면 된다.
``` diff
// Person 클래스
class Person {
  constructor(name) {
    this._name = name;
  }
  get name() { return this._name; }
  get department() { return this._department; }
  set department(arg) { this._department = arg; }
+ get manager() { return this._department.manager; }
}
// Department 클래스
class Department {
  get chargeCode() { return this._chargeCode; }
  set chargeCode(arg) { this._chargeCode = arg; }
  get manager() { return this._manager; }
  set manager(arg) { this._manager = arg; }
}
// 클라이언트
const manager = aPerson.department.manager;
```
##### STEP 2
[(2)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter07/7-7.md#2-%ED%81%B4%EB%9D%BC%EC%9D%B4%EC%96%B8%ED%8A%B8%EA%B0%80-%EC%9C%84%EC%9E%84-%EA%B0%9D%EC%B2%B4-%EB%8C%80%EC%8B%A0-%EC%84%9C%EB%B2%84%EB%A5%BC-%ED%98%B8%EC%B6%9C%ED%95%98%EB%8F%84%EB%A1%9D-%EC%88%98%EC%A0%95%ED%95%9C%EB%8B%A4-%ED%95%98%EB%82%98%EC%94%A9-%EB%B0%94%EA%BF%80-%EB%95%8C%EB%A7%88%EB%8B%A4-%ED%85%8C%EC%8A%A4%ED%8A%B8%ED%95%9C%EB%8B%A4) 이제 모든 클라이언트가 이 메서드를 사용하도록 고친다.
``` diff
// Person 클래스
class Person {
  constructor(name) {
    this._name = name;
  }
  get name() { return this._name; }
  get department() { return this._department; }
  set department(arg) { this._department = arg; }
  get manager() { return this._department.manager; }
}
// Department 클래스
class Department {
  get chargeCode() { return this._chargeCode; }
  set chargeCode(arg) { this._chargeCode = arg; }
  get manager() { return this._manager; }
  set manager(arg) { this._manager = arg; }
}
// 클라이언트
-const manager = aPerson.department.manager;
+const manager = aPerson.manager;
```
##### STEP 3
[(3)]() 클라이언트 코드를 다 고쳤다면 사람 클래스의 `department()` 접근자를 삭제한다.
``` diff
// Person 클래스
class Person {
  constructor(name) {
    this._name = name;
  }
  get name() { return this._name; }
- get department() { return this._department; }
  set department(arg) { this._department = arg; }
  get manager() { return this._department.manager; }
}
// Department 클래스
class Department {
  get chargeCode() { return this._chargeCode; }
  set chargeCode(arg) { this._chargeCode = arg; }
  get manager() { return this._manager; }
  set manager(arg) { this._manager = arg; }
}
// 클라이언트
const manager = aPerson.manager;
```