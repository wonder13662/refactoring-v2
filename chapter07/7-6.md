# 7.6 클래스 인라인하기(Inline Class)
반대 리팩터링: [7.5 클래스 추출하기(Extract Class)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter07/7-5.md)
``` diff
class Person {
- get officeAreaCode() { return this._telephoneNubmer.areaCode; }
+ get officeAreaCode() { return this._officeAreaCode; }
- get officeNumber() { return this._telephoneNumber.number; }
+ get officeNumber() { return this._officeNumber; }
}
-class TelephoneNumber {
- get areaCode() { return this._areaCode; }
- get number() { return this._number; }
-}
```
## 배경
클래스 인라인하기는 [7.5 클래스 추출하기(Extract Class)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter07/7-5.md)를 거꾸로 돌리는 리팩터링이다. 나는 더 이상 제 역할을 못해서 그대로 두면 안 되는 클래스는 인라인해버린다. 역할을 옮기는 리팩터링을 하고나니 특정 클래스에 남은 역할이 거의 없을 때 이런 현상이 자주 생긴다. 이럴 땐 이 불쌍한 클래스를 가장 많이 사용하는 클래스로 흡수시키자.

두 클래스의 기능을 지금과 다르게 배분하고 싶을 때도 클래스를 인라인한다. 클래스를 인라인해서 하나로 합친 다음 새로운 [7.5 클래스 추출하기(Extract Class)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter07/7-5.md)하는 게 쉬울 수도 있기 때문이다. 이는 코드를 재구성할 때 흔히 사용하는 방식이기도 하다. 상황에 따라 한 컨텍스트의 요소들을 다른 쪽으로 하나씩 옮기는 게 쉬울 수도 있고, 인라인 리팩터링으로 하나로 합친 후 추출하기 리팩터링으로 다시 분리하는 게 쉬울 수도 있다.
## 절차
### (1)
소스 클래스의 각 public 메서드에 대응하는 메서드들을 타깃 클래스에 생성한다. 이 메서드들은 단순히 작업을 소스 클래스로 위임해야 한다.
### (2)
소스 클래스의 메서드를 사용하는 코드를 모두 타킷 클래스의 위임 메서드를 사용하도록 바꾼다. 하나씩 바꿀 때마다 테스트한다.
### (3)
소스 클래스의 메서드와 필드를 모두 타킷 클래스로 옮긴다. 하나씩 옮길 때마다 테스트한다.
### (4)
소스 클래스를 삭제하고 조의를 표한다.

## 예시
배송 추적 정보를 표현하는 `TrackingInformation` 클래스를 준비했다. `TrackingInformation` 클래스는 `Shipment`(배송) 클래스의 일부처럼 사용된다.
``` javascript
// TrackingInformation 클래스
class TrackingInformation {
  get shippingCompany() { return this._shippingCompany; }
  set shippingCompany(arg) { this._shippingCompany = arg; } 
  get trackingNumber() { return this._trackingNumber; }
  set trackingNumber(arg) { this._trackingNumber = arg; }
  get display() {
    return `${this.shippingCompany} ${this.trackingNumber}`;
  }
}
// Shipment 클래스
class Shipment {
  get trackingInfo() {
    return this._trackingInformation.display;
  }
  get trackingInformation() { return this._trackingInformation; }
  set trackingInformation(aTrackingInformation) {
    this._trackingInformation = aTrackingInformation;
  }
}
// 클라이언트
aShipment.trackingInformation.shippingCompany = request.vendor;
```
### STEP 1
`TrackingInformation`이 예전에는 유용했을지 몰라도 현재는 제 역할을 못하고 있으니 `Shipment` 클래스로 인라인하려고 한다.

먼저 `TrackingInformation`의 메서드를 호출하는 코드를 찾는다.

[(1)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter07/7-6.md#1) 이처럼 외부에서 직접 호출하는 `TrackingInformation`의 메서드들을 모조리 `Shipment`로 옮긴다. 그런데 보통 때의 [8.1 함수 옮기기(Move Function)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter08/8-1.md)와는 약간 다르게 진행해보자. 먼저 `Shipment`에 위임 함수를 만들고 [(2)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter07/7-6.md#2) 클라이언트가 이를 호출하도록 수정하는 것이다.
``` diff
// TrackingInformation 클래스
class TrackingInformation {
  get shippingCompany() { return this._shippingCompany; }
  set shippingCompany(arg) { this._shippingCompany = arg; } 
  get trackingNumber() { return this._trackingNumber; }
  set trackingNumber(arg) { this._trackingNumber = arg; }
  get display() {
    return `${this.shippingCompany} ${this.trackingNumber}`;
  }
}
// Shipment 클래스
class Shipment {
  get trackingInfo() {
    return this._trackingInformation.display;
  }
  get trackingInformation() { return this._trackingInformation; }
  set trackingInformation(aTrackingInformation) {
    this._trackingInformation = aTrackingInformation;
  }
+ set shippingCompany(arg) { this._trackingInformation.shippingCompany = arg; }
}
// 클라이언트
-aShipment.trackingInformation.shippingCompany = request.vendor;
+aShipment.shippingCompany = request.vendor;
```
### STEP 2
클라이언트에서 사용하는 `TrackingInformation`의 모든 요소를 이런 식으로 처리한다.
``` diff
// TrackingInformation 클래스
class TrackingInformation {
  get shippingCompany() { return this._shippingCompany; }
  set shippingCompany(arg) { this._shippingCompany = arg; } 
  get trackingNumber() { return this._trackingNumber; }
  set trackingNumber(arg) { this._trackingNumber = arg; }
  get display() {
    return `${this.shippingCompany} ${this.trackingNumber}`;
  }
}
// Shipment 클래스
class Shipment {
  get trackingInfo() {
    return this._trackingInformation.display;
  }
  get trackingInformation() { return this._trackingInformation; }
  set trackingInformation(aTrackingInformation) {
    this._trackingInformation = aTrackingInformation;
  }
+ get shippingCompany() { return this._trackingInformation.shippingCompany; }
  set shippingCompany(arg) { this._trackingInformation.shippingCompany = arg; }
+ get trackingNumber() { return this._trackingInformation.trackingNumber; }
+ set trackingNumber(arg) { this._trackingInformation.trackingNumber = arg; }
}
// 클라이언트
aShipment.shippingCompany = request.vendor;
```
### STEP 3
[(3)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter07/7-6.md#3) 다 고쳤다면 `TrackingInformation`의 모든 요소를 `Shipment`로 옮긴다.

먼저 `display()` 메서드를 [6.2 함수 인라인하기(Inline Function)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter06/6-2.md)한다.
``` diff
// TrackingInformation 클래스
class TrackingInformation {
  get shippingCompany() { return this._shippingCompany; }
  set shippingCompany(arg) { this._shippingCompany = arg; } 
  get trackingNumber() { return this._trackingNumber; }
  set trackingNumber(arg) { this._trackingNumber = arg; }
  get display() {
    return `${this.shippingCompany} ${this.trackingNumber}`;
  }
}
// Shipment 클래스
class Shipment {
  get trackingInfo() {
-   return this._trackingInformation.display;
+   return `${this.shippingCompany}: ${this.trackingNumber}`;
  }
  get trackingInformation() { return this._trackingInformation; }
  set trackingInformation(aTrackingInformation) {
    this._trackingInformation = aTrackingInformation;
  }
  get shippingCompany() { return this._trackingInformation.shippingCompany; }
  set shippingCompany(arg) { this._trackingInformation.shippingCompany = arg; }
  get trackingNumber() { return this._trackingInformation.trackingNumber; }
  set trackingNumber(arg) { this._trackingInformation.trackingNumber = arg; }  
}
// 클라이언트
aShipment.shippingCompany = request.vendor;
```
### STEP 4
다음은 배송 회사 필드 차례다.
``` diff
// TrackingInformation 클래스
class TrackingInformation {
  get shippingCompany() { return this._shippingCompany; }
  set shippingCompany(arg) { this._shippingCompany = arg; } 
  get trackingNumber() { return this._trackingNumber; }
  set trackingNumber(arg) { this._trackingNumber = arg; }
  get display() {
    return `${this.shippingCompany} ${this.trackingNumber}`;
  }
}
// Shipment 클래스
class Shipment {
  get trackingInfo() {
    return `${this.shippingCompany}: ${this.trackingNumber}`;
  }
  get trackingInformation() { return this._trackingInformation; }
  set trackingInformation(aTrackingInformation) {
    this._trackingInformation = aTrackingInformation;
  }
- get shippingCompany() { return this._trackingInformation.shippingCompany; }
+ get shippingCompany() { return this._shippingCompany; }
- set shippingCompany(arg) { this._trackingInformation.shippingCompany = arg; }
+ set shippingCompany(arg) { this._shippingCompany = arg; }
  get trackingNumber() { return this._trackingInformation.trackingNumber; }
  set trackingNumber(arg) { this._trackingInformation.trackingNumber = arg; }  
}
// 클라이언트
aShipment.shippingCompany = request.vendor;
```
여기서는 이동할 목적지인 `Shipment`에서 `shippingCompany()`만 참조하므로 [8.2 필드 옮기기(Move Field)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter08/8-2.md)의 절차를 모두 수행하지 않아도 된다. 그래서 타깃을 참조하는 링크를 소스에 추가하는 단계는 생략한다.

### STEP 5
이 과정을 반복하고, [(4)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter07/7-6.md#4) 다 옮겼다면 `TrackingInformation` 클래스를 삭제한다.
``` diff
// TrackingInformation 클래스
-class TrackingInformation {
- get shippingCompany() { return this._shippingCompany; }
- set shippingCompany(arg) { this._shippingCompany = arg; } 
- get trackingNumber() { return this._trackingNumber; }
- set trackingNumber(arg) { this._trackingNumber = arg; }
- get display() {
-   return `${this.shippingCompany} ${this.trackingNumber}`;
- }
-}
// Shipment 클래스
class Shipment {
  get trackingInfo() {
    return `${this.shippingCompany}: ${this.trackingNumber}`;
  }
  get trackingInformation() { return this._trackingInformation; }
  set trackingInformation(aTrackingInformation) {
    this._trackingInformation = aTrackingInformation;
  }
  get shippingCompany() { return this._shippingCompany; }
  set shippingCompany(arg) { this._shippingCompany = arg; }
- get trackingNumber() { return this._trackingInformation.trackingNumber; }
+ get trackingNumber() { return this._trackingNumber; }
- set trackingNumber(arg) { this._trackingInformation.trackingNumber = arg; }
+ set trackingNumber(arg) { this._trackingNumber = arg; }
}
// 클라이언트
aShipment.shippingCompany = request.vendor;
```

- [7.5 클래스 추출하기(Extract Class)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter07/7-5.md)
- [7.7 위임 숨기기(Hide Delegate)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter07/7-7.md)
