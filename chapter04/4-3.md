# 4.3 첫 번째 테스트(A First Test)
이 코드를 테스트하기 위해서는 먼저 테스트 프레임워크를 마련해야 한다. 시중에는 다양한 프레임워크가 있는데, 자바스크립트용으로 나온 것만 해도 여러 개다. 여기서는 현재 널리 쓰이고 나름 좋다고 알려진 모카(Mocha)를 사용한다.

> 위 내용의 테스트 코드들은 src 디렉터리 안에 작성해두었습니다. 테스트프레임워크는 모카(Mocha)가 아닌 Jest를 사용했습니다.

종합적인 사용법을 설명하기 보다는 테스트 예시 몇 가지를 실행하는 모습을 바로 보여주겠다. 다른 프레임워크를 사용하더라도 비슷한 테스트를 어렵지 않게 구축할 수 있을 것이다.

다음은 생산 부족분을 제대로 계산하는지 확인하는 테스트다.
```javascript
describe('province', function() {
  it('shortfall', function() {
    const asia = new Province(sampleProvinceData()); // 1. 픽스처 설정
    assert. equal(asia.shortfall, 5); // 2. 검증
  });
});
```

모카 프레임워크는 테스트 코드를 블록 단위로 나눠서 각 블록에 테스트 스위트를 담는 구조다. 테스트는 `it`블록에 담긴다. 앞의 예에서는 테스트를 두 단계로 진행했다. (1)첫 번째 단계에서는 테스트에 필요한 데이터와 객체를 뜻하는 픽스처(fixture)를 설정한다. 이 예시에서는 샘플 지역 정보로부터 생성한 `Province` 객체를 픽스처로 설정했다. (2)두 번째 단계에서는 이 픽스처의 속성들을 검증하는데, 여기서는 주어진 초깃값에 기초하여 생산 부족분을 정확히 계산했는지 확인한다.

> `describe` 블록과 `it` 블록에 부연 설명용 문자열을 써 넣는 방식은 개발자마다 다르다. 테스트가 무엇을 검사하는지를 설명해 넣는 사람이 있는 반면, 마치 명확한 코드에는 주석이 필요 없는 것과 같은 맥락에서 이 공간을 그냥 비워두는 사람도 있다. 나는 실패한 테스트가 무엇인지 식별할 수 있을 정도로만 작성하는 편이다.

이 테스트를 Node.js 콘솔에서 실행하면 다음과 같이 출력된다.

![첫 테스트 이미지](4-3-first-test.png)

피드백이 굉장히 간결하다. 보다시피 수행한 테스트와 통과한 테스트의 수만 간략히 보여준다.

> 실패해야 할 상황에는 반드시 실패하게 만들자.

지금처럼 기존 코드를 검증하는 테스트를 작서했고 모두 통과했다는 건 좋은 일이다. 하지만 나는 기본적으로 회의적인 인간이다. 특히 수많은 테스트를 실행했음에도 실패하는 게 없다면 테스트가 내 의도와는 다른 방식으로 코드를 다루는 건 아닌지 불안해진다. 그래서 각각의 테스트가 실패하는 모습을 최소한 한 번씩은 직접 확인해본다. 이를 위해 내가 흔히 쓰는 방법은 일시적으로 코드에 오류를 주입하는 것이다. 예를 들면 다음과 같다.
```javascript
class Province {
  // 생략
  get shortfall() {
    return this._demand - this.totalProduction * 2; // 오류 주입
  }
  // 생략
}
```