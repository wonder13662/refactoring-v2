# 4.7 끝나지 않은 여정(Much More Than this)
이 장에서 설명할 내용은 여기까지다. 결국 이 책의 주제는 테스트가 아닌 리팩터링이다. 그렇지만 테스트도 굉장히 중요한 주제다. 리팩터링에 반드시 필요한 토대일 뿐만 아니라, 그 자체로도 프로그래밍에 중요한 역학을 한다. 이 책 초판이 출간된 이후로 리팩터링이 프로그래밍 실천법 중 하나로 자리 잡는 것을 보면서 뿌듯했지만, 테스트에 대한 인식도 달라지는 것을 보니 그보다 훨씬 기뻤다. 예전에는 테스트를 별도의 (그리고 실력이 좀 떨어지는) 조직에 맡겼지만, 이제는 뛰어난 소프트웨어 개발자라면 최우선으로 관심을 가지는 주제로 떠오르고 있다. 테스트 용이성(testability)을 아키첵처 평가 기준으로 활용하는 사례도 많다.

이 장에서 보여준 테스트는 단위 테스트(unit test)에 해당한다. 단위 테스트란 코드의 작은 영역만을 대상으로 빠르게 실행되도록 설계된 테스트다. 단위 테스트는 자가 테스트 코드의 핵심이자, 자가 테스트 시스템은 대부분 단위 테스트가 차지한다. 물론 컴포넌트 사이의 상호작용에 직줍하는 테스트나, 소프트웨어의 다양한 계층의 연동을 검사하는 테스트, 성능 문제를 다루는 테스트 등 다양한 유형의 테스트가 있다(테스트 유형도 많지만, 유형을 분류하는 방식에 대한 논쟁은 그보다 더 많다).

다른 프로그래밍 활동과 마찬가지로 테스트도 반복적으로 진행한다. 실력이 굉장히 뛰어나거나 운이 아주 좋지 않은 한, 한 번에 완벽한 테스트를 갖출 순 없다. 나는 제품 코드에 못지 않게 테스트 스위트도 지속해서 보강한다. 다시 말해 기능을 새로 추가할 때마다 테스트도 추가하는 것은 물론, 기존 테스트도 다시 살펴본다. 기존 테스트가 충분히 명확한지, 테스트 과정을 더 이해하기 쉽게 리팩터링할 수는 없는지, 제대로 검사하는지 등을 확인한다. 버그를 발견하는 즉시 발견한 버그를 명확히 잡아내는 테스트부터 작성하는 습관을 들이자. 아주 중요한 습관이다! 나는 버그를 고치기 전에 항상 이런 테스트부터 만든다. 그러면 해당 버그가 다시 나타나지 않는지 확인할 수 있다. 또한 그 버그와 테스트를 계기로 테스트 스위트에 또 다른 구멍은 없는지까지 살펴본다.

> 버그 리포트를 받으면 가장 먼저 그 버그를 드러내는 단위 테스트부터 작성하자.

"어느 정도 하면 충분히 테스트했다고 할 수 있나요?"라는 질문을 참 많이 받는다. 명확한 기준은 없다. [테스트 커버리지 - test coverage](https://martinfowler.com/bliki/TestCoverage.html)를 기준으로 삼는 사람도 있지만, 테스트 커버리지 분석은 코드에서 테스트하지 않은 영역을 찾는 데만 도움될 뿐, 테스트 스위트의 품질과는 크게 상관없다.

테스트 스위트가 충분한지를 평가하는 기준은 주관적이다. 가령 '누군가 결함을 심으면 테스트가 발견할 수 있다는 믿음'을 기준으로 할 수 있다. 이런 기준은 객관적으로 측정할 수 없어서 헛된 믿음일 뿐인지 알 도리가 없다. 하지만 자가 테스트 코드의 목적은 이 믿음을 갖게 해주는 것이다. 리팩터링 후 테스트 결과가 모두 초록색인 것만 보고도 리팩터링 과정에서 생겨난 버그가 하나도 없다고 확신할 수 있다면 충분히 좋은 테스트 스위트라고 할 수 있다.

테스트를 너무 많이 작성할 가능성도 있다. 제품 코드보다 테스트 코드를 수정하는 데 시간이 더 걸린다면, 그리고 테스트 때문에 개발 속도가 느려진다고 생각되면 테스트를 과하게 작성한 건 아닌지 의심해보자. 하지만 너무 많은 경우보다는 너무 적은 경우가 훨씬 훨씬 많다.