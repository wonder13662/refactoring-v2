# 1.2 예시 프로그램을 본 소감
이 프로그램의 설계를 보고 난 소감은 어떤가? 나는 이 상태로도 그럭저럭 쓸만하다는 생각이 든다. 프로그램이 너무 짧아서 특별히 애써 이해해야 할 구조도 없다. 앞에서 설명했듯이 이 책에서는 이처럼 짧은 예만 소개한다. 하지만 이런 코드가 수백 줄짜리 프로그램의 일부라면 간단한 인라인 함수 하나라도 이해하기 쉽지 않다.

프로그램이 잘 작동하는 상황에서 그저 코드가 '지저분하다'는 이유로 불평하는 것은 프로그램의 구조를 너무 미적인 기준으로만 판단하는 건 아닐까? 컴파일러는 코드가 깔끔하든 지저분하든 개의치 않으니 말이다. 하지만 그 코드를 수정하려면 사람이 개입되고, 사람은 코드의 미적 상태에 민감하다. 설계가 나쁜 시스템은 수정하기 어렵다. 원하는 동작을 수행하도록 하기 위해 수정해야 할 부분을 찾고, 기존 코드와 잘 맞물려 작동하게 할 방법을 강구하기가 어렵기 때문이다. 무엇을 수정할지 찾기 어렵다면 실수를 저질러서 버그가 생길 가능성도 높아진다.

그래서 나는 수백 줄짜리 코드를 수정할 때면 먼저 프로그램의 작동 방식을 더 쉽게 파악할 수 있도록 코드를 여러 함수와 프로그램 요소로 재구성한다. 프로그램의 구조가 빈약하다면 대체로 구조부터 바로잡은 뒤에 기능을 수정하는 편이 작업하기가 훨씬 수월할다.

> 프로그램이 새로운 기능을 추가하기에 편한 구조가 아니라면, 먼저 기능을 추가하기 쉬운 형태로 리팩터링하고 나서 원하는 기능을 추가한다.

자, 이 코드에서 사용자의 입맛에 맞게 수정할 부분을 몇 개 발견했다. 가장 먼저 청구 내역을 HTML로 출력하는 기능이 필요하다. 이 변경이 어느 부분에 영향을 줄지 생각해보자. 우선(HTML 태그를 삽입해야 하니) 청구 결과에 문자열을 추가하는 문장 각각을 조건문으로 감싸야한다. 그러면 `statement()` 함수의 복잡도가 크게 증가한다. 이런 상황이라면 대부분 이 함수의 복사본을 만들고 복사본에서 HTML을 출력하는 식으로 처리할 것이다.이때 복사하는 일 자체는 그리 부담되지 않지만, 나중에 수많은 문제를 일으킬 여지가 있다. 청구서 작성 로직을 변경할 때마다 기존 함수와 HTML 버전 함수 모두를 수정하고, 항시 일관되게 수정했는지도 확인해야 한다. 로직을 변경할 일이 절대 없다면 이렇게 복사해서 붙이는 방식도 상관없지만, 오래 사용할 프로그램이라면 중복 코드는 골칫거리가 된다.

이는 두 번째 변경 사항과도 관련이 있다. 배우들은 사극, 전원극, 전원 희극, 역사 전원극, 역사 비극, 희비 역사 전원극, 장면 변화가 없는 고전극, 길이와 시간과 장소에 제약 없는 자유극 등 더 많은 장르를 연기하고 싶어 한다. 언제 어떤 연극을 할지는 아직 결정하지 못했지만, 이 변경은 공연료와 적립 포인트 계산법에 영향을 줄 것이다. 경험 많은 개발자로서 내가 장담하건데, 어떤 방식으로 정하든 반드시 6개월 안에 다시 변경하게 될 것이다. 새로운 요구사항은 수색 대원처럼 한두 명씩이 아니라, 한 부대씩 몰려오기 마련이다.

이처럼 연극 장르와 공연료 정책이 달라질 때마다 `statement()` 함수를 수정해야 한다. 만약 `statement()`를 복사해서 별도의 `htmlStatement()`를 만든다면 모든 수정이 두 함수에 일관되게 반영되도록 보장해야 한다. 게다가 정책이 복잡해질수록 수정할 부분을 찾기 어려워지고 수정 과정에서 실수할 가능성도 커진다.

리팩터링이 필요한 이유는 바로 이러한 변경 때문이다. 잘 작동하고 나중에 변경할 일이 절대 없다면 코드를 현재 상태로 놔둬도 아무런 문제가 없다. 더 다음어두면 물론 좋겠지만, 누군가 코드를 읽지 않는 한 아무런 피해가 없다. 하지만 그러다 다른 사람이 읽고 이해해야 할 일이 생겼는데 로직을 파악하기 어렵다면 뭔가 대책을 마련해야 한다.

- [목차](https://github.com/wonder13662/refactoring-v2/blob/writing/README.md)
- [1 리팩터링: 첫 번째 예시](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter01)
- [1.1 자, 시작해보자!](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter01/1-1.md)
- [1.3 리팩터링의 첫 단계](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter01/1-3.md)