### 1.1 자, 시작해보자!
초판에서는 첫 예시로 비디오 대여점에서 영수증을 출력하는 프로그램을 소개했다. 그런데 요즘 독자는 비디오 대여점이 뭔지 모를 수도 있겠다는 생각이 들어서, 기본 틀은 유지하되 지금 시대에 맞게 각색하기로 했다.

다양한 연극을 외주로 받아서 공연하는 극단이 있다고 생각해보자. 공연 요청이 들어오면 연극의 장르와 관객 규모를 기초로 비용을 책정한다. 현재 이 극단은 두 가지 장르, 비극(tragedy)과 희극(comedy)만 공연한다. 그리고 공연료와 별개로 포인트(volume credit)를 지급해서 다음번 의뢰 시 공연료를 할인받을 수도 있다. 일종의 충성도 프로그램인 셈이다.

극단은 공연할 연극 정보를 다음과 같이 간단한 JSON 파일에 저장한다.

``` json
// plays.json
{
  "hamlet": {"name": "Hamlet", "type": "tragedy"},
  "as-like": {"name": "As You Like it", "type": "comedy"},
  "othello": {"name": "Othello", "type": "tragedy"},
}
```
공연료 청구서에 들어갈 데이터도 다음과 같이 JSON 파일로 표현한다.
``` json
// invoices.json
[
  {
    "customer": "BigCo",
    "performances": [
      {
        "playID": "hamlet",
        "audience": 55,
      },
      {
        "playID": "as-like",
        "audience": 35,
      },
      {
        "playID": "othello",
        "audience": 40,
      },
    ]
  }
]
```
공연료 청구서를 출력하는 코드는 다음과 같이 간단히 함수로 구현했다.
``` javascript
function statement(invoice, plays) {
  let totalAmount = 0;
  let volumeCredits = 0;
  let result = `청구 내역 (고객명: ${invoice.customer})\n`;
  const format = new Intl.NumberFormat("en-US", {
    style: "currency", 
    currency: "USD",
    minimumFractionDigits: 2,
  }).format;

  for (let perf of invoice.performances) {
    const play = plays[perf.playID];
    let thisAmount = 0;

    switch(play.type) {
      case "tragedy": // 비극
        thisAmount = 40000;
        if (perf.audience > 30) {
          thisAmount += 1000 * (perf.audience - 30);
        }
        break;
      case "comedy": // 희극
        thisAmount = 30000;
        if (perf.audience > 20) {
          thisAmount += 10000 + 500 * (perf.audience - 30);
        }
        thisAmount += 300 * perf.audience;
        break;
      default:
        throw new Error(`알 수 없는 장르: ${play.type}`);
    }

    // 포인트를 적립한다.
    volumeCredits += Math.max(perf.audience - 30, 0);
    // 희극 관객 5명마다 추가 포인트를 제공한다.
    if ("comedy" === play.type) volumeCredits += Math.floor(perf.audience / 5);

    // 청구 내역을 출력한다.
    result += ` ${play.name}: ${format(thisAmount/100)} (${perf.audience}석)`;
    totalAmount += thisAmount;
  }

  result += `총액: ${format(totalAmount/100)}\n`
  result += `적립 포인트: ${volumeCredits}점\n`
  return result;
}
```
이 코드에 앞의 두 테스트 데이터 파일(plays.json과 invoices.json)을 입력해 실행한 결과는 다음과 같다.
```
청구내역 (고객명: BigCo)
 hamlet: $650.00 (55석)
 As You Like It: $580.00 (35석)
 othello: $500.00 (40석)
총액: $1,730.00
적립 포인트: 47점
```

(참고)이 프로그램을 직접 src 디렉토리에서 구동해 볼 수 있습니다.
``` bash
// 실행해보기
$ node index.js
// 테스트해보기
$ npm run test
```