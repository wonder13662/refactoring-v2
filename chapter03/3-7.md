# 3.7 뒤엉킨 변경(Divergent Change)
우리는 소프트웨어의 구조를 변경하기 쉬운 형태로 조직한다. 소프트웨어는 자고로 소프트해야 마땅하기 때문이다. 코드를 수정할 때는 시스템에서 고쳐야 할 딱 한 군데를 찾아서 그 부분만 수정할 수 있기를 바란다. 이렇게 할 수 없다면 (서로 밀접한 악취인) [3.7 뒤엉킨 변경(Divergent Change)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter03/3-7.md)과 [3.8 산탄총 수술(Shotgun Surgery)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter03/3-8.md) 중 하나가 풍긴다.

[3.7 뒤엉킨 변경(Divergent Change)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter03/3-7.md)은 단일 책임 원칙(SRP - Single Responsibility Principle)이 제대로 지켜지지 않을 때 나타난다. 즉, 하나의 모듈이 서로 다른 이유들로 인해 여러 가지 방식으로 변경되는 일이 많을 때 발생한다. 예컨대 지원해야 할 데이터베이스가 추가될 때마다 함수 세 개를 바꿔야 하고, 금융 상품이 추가될 때마다 또 다른 함수 네 개를 바꿔야 하는 모듈이 있다면 뒤엉킨 변경이 발생했다는 뜻이다. 데이터베이스 연동과 금융 상품의 처리는 서로 다른 맥락에서 이뤄지므로 독립된 모듈로 분리해야 프로그래밍이 편하다. 그래야 무언가를 수정할 때 해당 맥락의 코드만 이해해도 진행할 수 있다. 우리는 이렇게 분리하는 일이 중요함을 예전부터 알고 있었지만 나이를 먹어 두뇌회전이 느려지는 요즘에는 더더욱 중요한 일이 돼버렸다. 물론 데이터베이스와 금융 상품 여러 개를 추가하고 나서야 이 악취가 느껴지는 경우도 많다. 개발 초기에는 맥락 사이의 경계를 명확히 나누기가 어렵고 소프트웨어 시스템의 기능이 변경되면서 이 경계도 끊임없이 움직이기 때문이다.

데이터베이스에서 데이터를 가져와서 금융 상품 로직에서 처리해야 하는 일처럼 순차적으로 실행되는 게 자연스러운 맥락이라면, 다음 맥락에 필요한 데이터를 특정한 데이터 구조에 담아 전달하게 하는 식으로 단계를 분리한다([6.11 단계 쪼개기(Split Phase)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter06/6-11.md)). 전체 처리 과정 곳곳에서 각기 다른 맥락의 함수를 호출하는 빈도가 높다면, 각 맥락에 해당하는 적당한 모듈들을 만들어서 관련 함수들을 모은다([8.1 함수 옮기기(Move Function)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter08/8-1.md)).그러면 처리 과정이 맥락별로 구분된다. 이때 여러 맥락의 일에 관여하는 함수가 있다면 옮기기 전에 [6.1 함수 추출하기(Extract function)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter06/6-1.md)부터 수행한다. 모듈이 클래스라면 [7.5 클래스 추출하기(Extract Class)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter07/7-5.md)가 맥락별 분리 방법을 잘 안내해줄 것이다.

- [목차](https://github.com/wonder13662/refactoring-v2/blob/writing)
- [3 코드에서 나는 악취](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter03)
- [3.6 가변 데이터(Mutable Data)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter03/3-6.md)
- [3.8 산탄총 수술(Shotgun Surgery)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter03/3-8.md)
