# 3.17 메시지 체인(Message Chains)
메시지 체인은 클라이언트가 한 객체를 통해 다른 객체를 얻은 뒤 방금 얻은 객체에 또 다른 객체를 요청하는 식으로, 다른 객체를 요청하는 작업이 연쇄적으로 이어지는 코드를 말한다. 가령 `getSomething()`같은 게터가 꼬리에 꼬리를 물고 이어지거나 임시 변수들이 줄줄이 나열되는 코드가 있다. 이는 클라이언트가 객체 네비게이션 구조에 종속됐음을 의미한다. 그래서 내비게이션 중간 단계를 수정하면 클라이언트 코드도 수정해야 한다.

이 문제는 [7.7 위임 숨기기(Hide Delegate)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter07/7-7.md)로 해결한다. 이 리팩터링은 메시지 체인의 다양한 연결점에 적용할 수 있다. 원칙적으로 체인을 구성하는 모든 객체에 적용할 수 있지만, 그러다 보면 중간 객체들이 모두 [3.18 중개자(Middle Man)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter03/3-18.md)가 돼버리기 쉽다. 그러니 최종 결과 객체가 어떻게 쓰이는지부터 살펴보는 게 좋다. [6.1 함수 추출하기(Extract function)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter06/6-1.md)로 결과 객체를 사용하는 코드 일부를 따로 빼낸 다음 [8.1 함수 옮기기(Move Function)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter08/8-1.md)로 체인을 숨길 수 있는지 살펴보자. 체인을 구성하는 객체 중 특정 하나를 사용하는 클라이언트 중 그 이후의 객체들도 사용하길 원하는 클라이언트가 제법 된다면, 이 요구를 처리해줄 메서드를 추가한다.

메서드 체인을 무조건 나쁘게 생각하는 사람도 있다. 사람들이 우리를 차분하고 합리적인 중도를 지향한다고 평하는데, 최소한 이 문제에서는 그렇다고 볼 수 있다.
## 예시
앞의 문단은 [7.7 위임 숨기기(Hide Delegate)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter07/7-7.md)를 읽고 온 후라도 한 번에 이해하기 어려울 것 같아서 예시를 준비했다. 우선 다음 코드가 메시지 체인의 전형적인 예다.

``` javascript
managerName = aPerson.department.manager.name;
```

'체인을 구성하는 모든 객체에 위임 숨기기를 적용할 수 있다'고 함은 `manager` 이름을 바로 반환하는 메서드를 `Person` 클래스에 추가할 수도 있고, `Department` 클래스에 추가할 있다는 뜻이다. 혹은 `manager`를 얻은 메서드를 `Person` 클래스에 추가할 수도 있다.

``` javascript
managerName = aPerson.department.managerName; // Manager 객체의 존재를 숨김
managerName = aPerson.manager.name; // Department 객체의 존재를 숨김
managerName = aPerson.managerName; // Department 객체와 Manager 객체 모두의 존재를 숨김
```
이 체인의 최종 결과 객체는 `name`이 반환하는 `manager`의 이름이다. 이 객체가 다음처럼 쓰인다고 해보자.
``` javascript
managerName = aPerson.department.manager.name;
report = `${managerName}께 ${aPerson.name}님의 작업로그 ...`;
console.log(report);
```
여기서 보고서 생성 로직을 함수로 추출한 다음 적당한 모듈로 옮기면 체인의 존재가 감춰진다.
``` diff
-managerName = aPerson.department.manager.name;
-report = `${managerName}께 ${aPerson.name}님의 작업로그 ...`;
-console.log(report);
+console.log(reportAutoGenerator.report(aPerson));
+const reportAutoGenerator = () => {
+ report: (aPerson) => `${aPerson.department.manager.name}께 ${aPerson.name}님의 작업로그 ...`,
+}
```
마지막으로 체인의 중간인 `department` 정보를 얻어 사용하는 다수의 클라이언트가 `manager`의 이름도 함께 사용한다면 `Department` 클래스에 `managerName()` 메서드를 추가하여 체인을 단축할 수 있다.

- [목차](https://github.com/wonder13662/refactoring-v2/blob/writing)
- [3 코드에서 나는 악취](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter03)
- [3.16 임시 필드(Temporary Field)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter03/3-16.md)
- [3.18 중개자(Middle Man)](https://github.com/wonder13662/refactoring-v2/blob/writing/chapter03/3-18.md)